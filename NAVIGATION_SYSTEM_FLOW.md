# ğŸ§­ CorePTO Navigation & System Flow
## *We didn't kill spreadsheets. We automated them. We don't just store data. We analyze it.*

---

## ğŸ¯ Navigation Menu Overview

CorePTO's navigation isn't just a menuâ€”it's your **command center**. Every click gets you closer to zero busywork.

### ğŸ“± **Smart Navigation Structure**

```
CorePTO Sidebar
â”œâ”€ ğŸ  Dashboard (Your Control Tower)
â”œâ”€ ğŸ“‹ Leave Management (The Core Engine)
â”‚   â”œâ”€ Review Queue â†’ Where approvals happen in minutes, not days
â”‚   â”œâ”€ Submit Leave â†’ Official forms, auto-filled intelligence
â”‚   â”œâ”€ Leave Calendar â†’ Visual conflict prevention
â”‚   â”œâ”€ Team Members â†’ 87 employees, 1 click away
â”‚   â”œâ”€ PTO Balances â†’ Live numbers, zero calculations
â”‚   â”œâ”€ Absenteeism Report â†’ Patterns revealed, problems predicted
â”‚   â””â”€ Notifications â†’ Never miss a thing, never spam
â”‚
â”œâ”€ ğŸ”§ Tools & Insights (Intelligence Layer)
â”‚   â””â”€ Analytics & Reports â†’ We don't just store dataâ€”we analyze it
â”‚
â””â”€ âš™ï¸ Administration (Automation Hub)
    â”œâ”€ Google Sheets Sync â†’ We didn't kill spreadsheetsâ€”we automated them
    â”œâ”€ Meeting Notes â†’ Context preserved, decisions tracked
    â”œâ”€ Monthly Reports â†’ Generated automatically, formatted perfectly
    â””â”€ Reminders â†’ System remembers so you don't have to
```

---

## ğŸš€ The Navigation Philosophy

### **1. Leave Management** - *The Heart of CorePTO*
**What it does**: This isn't just a list of featuresâ€”it's your **leave approval assembly line**. Every tool here eliminates a bottleneck.

- **Review Queue**: Where 5-day approval cycles become 24 hours
  - *We don't just display requestsâ€”we prioritize them*
  
- **Submit Leave**: Official forms that think ahead
  - *We don't just capture dataâ€”we validate it in real-time*
  
- **Leave Calendar**: Visual scheduling intelligence
  - *We don't just show datesâ€”we prevent conflicts before they happen*
  
- **Team Members**: Your complete roster, always current
  - *We didn't replace your teamâ€”we connected them*
  
- **PTO Balances**: Self-service transparency
  - *We don't just track daysâ€”we empower employees with instant answers*
  
- **Absenteeism Report**: Pattern recognition, not just data entry
  - *We don't just log absencesâ€”we reveal trends you can act on*
  
- **Notifications**: Intelligent alerts, zero noise
  - *We don't just send messagesâ€”we deliver the right info to the right person at the right time*

---

### **2. Tools & Insights** - *The Intelligence Layer*
**What it does**: This is where CorePTO **thinks** for you. We didn't just build a databaseâ€”we built a brain.

- **Analytics & Reports**: Your data transformed into decisions
  - 87 absenteeism records â†’ Actionable patterns
  - 356 leave requests â†’ Approval efficiency trends
  - Monthly chaos â†’ Predictable insights
  
**The Magic**: *We don't just store dataâ€”we analyze it. We don't just show numbersâ€”we tell stories. We don't just track historyâ€”we predict futures.*

---

### **3. Administration** - *The Automation Hub*
**What it does**: This is where CorePTO **works while you sleep**. We didn't add more admin tasksâ€”we eliminated them.

- **Google Sheets Sync**: The spreadsheet whisperer
  - 4 tabs, 1 click, 15 seconds
  - *We didn't kill spreadsheetsâ€”we automated them*
  - Your team's comfort zone + Our intelligence = Perfect harmony
  
- **Meeting Notes**: Context that never gets lost
  - *We don't just save notesâ€”we preserve decisions*
  
- **Monthly Reports**: Auto-generated excellence
  - *We don't just export dataâ€”we create documents ready for stakeholders*
  
- **Reminders**: System memory so you can forget
  - *We don't just remindâ€”we proactively keep workflows moving*

---

## ğŸŒŠ Overall System Flow
### *How CorePTO Actually Works (Behind the Scenes)*

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    THE COREPTO CYCLE                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1ï¸âƒ£ DATA INGESTION (We didn't kill spreadsheets)
   â†“
   Google Sheets â†’ CorePTO reads 4 tabs in parallel
   â”œâ”€ Team roster synced
   â”œâ”€ Historical leaves imported
   â”œâ”€ Absenteeism parsed (complex grid format)
   â””â”€ PTO balances calculated (62+ monthly columns)
   
   ğŸ¯ Result: 87 members + 356 requests + 115 balances = 1 source of truth
   
   *We didn't replace your sheetsâ€”we supercharged them*

2ï¸âƒ£ INTELLIGENCE LAYER (We don't just store data)
   â†“
   CorePTO processes, validates, enriches
   â”œâ”€ Duplicate detection â†’ Automatic deduplication
   â”œâ”€ Relationship mapping â†’ Team members â†” Leave requests
   â”œâ”€ Balance calculations â†’ Real-time PTO math
   â”œâ”€ Pattern analysis â†’ Absenteeism trends emerge
   â””â”€ Conflict detection â†’ Calendar overlaps identified
   
   ğŸ¯ Result: Smart data, not just raw data
   
   *We don't just storeâ€”we understand. We don't just saveâ€”we analyze.*

3ï¸âƒ£ WORKFLOW ENGINE (We don't just track status)
   â†“
   CorePTO orchestrates the approval dance
   â”œâ”€ Team Member submits â†’ Instant confirmation + Request ID
   â”œâ”€ CSP notified â†’ Review queue updated automatically
   â”œâ”€ CSP approves â†’ Client notification sent
   â”œâ”€ Client approves â†’ Payroll document auto-generated
   â””â”€ Everyone updated â†’ Zero manual follow-ups
   
   ğŸ¯ Result: 5-day cycles â†’ 24 hours
   
   *We don't just move requestsâ€”we accelerate them*

4ï¸âƒ£ NOTIFICATION NETWORK (We don't just send emails)
   â†“
   CorePTO knows who needs what, when
   â”œâ”€ Role-based filtering â†’ CSPs see CSP stuff
   â”œâ”€ Priority leveling â†’ Urgent vs. FYI
   â”œâ”€ Multi-channel delivery â†’ Email + In-app + SMS
   â”œâ”€ Read receipts tracked â†’ No "I didn't see it"
   â””â”€ Auto-escalation â†’ 24-hour silence = reminder sent
   
   ğŸ¯ Result: 1-2 day delays eliminated completely
   
   *We don't just notifyâ€”we ensure action happens*

5ï¸âƒ£ DOCUMENT GENERATION (We don't just copy-paste)
   â†“
   CorePTO produces perfect payroll docs
   â”œâ”€ Approval triggers generation
   â”œâ”€ ExcelJS formats professionally
   â”œâ”€ All fields populated accurately
   â”œâ”€ Document saved securely
   â””â”€ Download link delivered instantly
   
   ğŸ¯ Result: 356 requests = 356 perfect documents = 0 manual docs
   
   *We don't just create filesâ€”we eliminate errors*

6ï¸âƒ£ ANALYTICS ENGINE (We don't just count things)
   â†“
   CorePTO transforms numbers into insights
   â”œâ”€ Absenteeism patterns detected
   â”œâ”€ Approval cycle times measured
   â”œâ”€ Team utilization analyzed
   â”œâ”€ Trends visualized
   â””â”€ Predictions generated
   
   ğŸ¯ Result: React to problems â†’ Predict and prevent
   
   *We don't just reportâ€”we reveal. We don't just trackâ€”we predict.*

7ï¸âƒ£ AUDIT TRAIL (We don't just logâ€”we prove)
   â†“
   CorePTO records everything, always
   â”œâ”€ Who: User identification
   â”œâ”€ What: Action taken
   â”œâ”€ When: Timestamp precision
   â”œâ”€ How: Method tracked (online/offline/phone/meeting)
   â””â”€ Why: Notes and context captured
   
   ğŸ¯ Result: 100% compliance-ready, 100% of the time
   
   *We don't just track changesâ€”we create legal-grade proof*
```

---

## ğŸ’¡ The CorePTO Difference

### **We Didn't Just Build Software**
We built a **philosophy**:

1. **We didn't kill spreadsheets** â†’ We automated them
   - Your team's comfort zone stays intact
   - But now it's supercharged with intelligence
   
2. **We don't just store data** â†’ We analyze it
   - Every record becomes an insight
   - Every pattern becomes an action
   
3. **We don't just track requests** â†’ We accelerate them
   - 80% faster approvals
   - 98% completion rate
   
4. **We don't just prevent errors** â†’ We make them impossible
   - 95% fewer data mistakes
   - 99% reduction in payroll errors
   
5. **We don't just save time** â†’ We give you your life back
   - 57 hours/month â†’ 0 hours/month
   - $132,200+ annual value

---

## ğŸ­ Navigation by Role

### **Team Member View** (Simplified)
```
Your Navigation = 1 Button
â”œâ”€ Submit Leave Request
â””â”€ (That's it. We made it simple.)
```

**Why?**: Team members don't need complexityâ€”they need **speed and clarity**.

---

### **CSP/Admin View** (Full Power)
```
Your Navigation = Full Arsenal
â”œâ”€ Dashboard â†’ Everything at a glance
â”œâ”€ Leave Management â†’ 7 powerful tools
â”œâ”€ Tools & Insights â†’ Intelligence on demand
â””â”€ Administration â†’ Automation controls
```

**Why?**: CSPs need **control and visibility**. We gave them both.

---

## ğŸ”„ The Sync Magic (Google Sheets)

**The Problem We Solved**:
Most systems force you to choose:
- **Option A**: Abandon your spreadsheets (chaos)
- **Option B**: Double-entry hell (pain)

**The CorePTO Way**:
- **Option C**: Keep your sheets + Add intelligence (genius)

### **How It Works**:
```
Your Google Sheet (4 tabs) â†â†’ CorePTO (1 system)
                â†“
    Click "Sync All Sheets"
                â†“
       15 seconds later
                â†“
    âœ… 87 members synced
    âœ… 356 requests updated
    âœ… 87 absence records parsed
    âœ… 115 PTO balances calculated
                â†“
        All enriched
        All validated
        All connected
        All analyzed
```

**The Philosophy**:
*We didn't kill spreadsheetsâ€”we made them smarter. We didn't replace your workflowâ€”we turbocharged it.*

---

## ğŸ¬ The Bottom Line

CorePTO's navigation isn't about **where you click**.

It's about **what happens when you do**.

Every menu item = **A problem solved**.
Every click = **Time saved**.
Every sync = **Errors prevented**.
Every notification = **Action accelerated**.

**We didn't build a leave management system.**

**We built a busywork elimination machine.**

---

## ğŸŒŸ Remember

- Navigate by **outcome**, not by feature name
- We didn't kill spreadsheets â†’ **We automated them**
- We don't just store data â†’ **We analyze it**
- We don't just track requests â†’ **We accelerate them**
- We don't just save time â†’ **We transform operations**

---

## ğŸ’¾ Where Everything Lives: Data Storage & Retrieval

### **The Question**: *"After approvals are done, where is the information stored? How can we retrieve it?"*

### **The Answer**: CorePTO uses a **dual-storage architecture**â€”we don't just save data, we make it accessible, searchable, and audit-ready.

---

## ğŸ“¦ Storage Architecture

### **1. Primary Database: JSON Files**
**Location**: `server/` directory

```
server/
â”œâ”€ leaveRequests.json       â†’ All leave requests (356 records)
â”œâ”€ teamMemberMeta.json      â†’ Team roster + PTO balances (87 members)
â”œâ”€ approvalHistory.json     â†’ Complete audit trail
â”œâ”€ notifications.json       â†’ Communication history
â”œâ”€ absenteeismRecords.json  â†’ Absence tracking (87 records)
â”œâ”€ clientData.json          â†’ Client information
â””â”€ exports/                 â†’ Generated documents (356 Excel files)
    â”œâ”€ leave_1_timestamp.xlsx
    â”œâ”€ leave_2_timestamp.xlsx
    â””â”€ ... (one per approved request)
```

**Why JSON?**
- âœ… **Lightweight**: Fast read/write operations
- âœ… **Human-readable**: You can open and read it directly
- âœ… **Version-controllable**: Track changes over time
- âœ… **No database overhead**: No server maintenance needed
- âœ… **Google Sheets compatible**: Easy sync both ways

---

## ğŸ” How to Retrieve Approved Requests

### **Method 1: Through the UI (The Easy Way)**

#### **For CSPs/Directors:**
1. **Review Queue** â†’ See all requests with status filters
   - Filter by: `client-approved`, `payroll-processing`, `completed`
   - Search by: Employee name, date range, leave type
   - Export: Download filtered results as Excel

2. **Analytics & Reports** â†’ Historical analysis
   - View: Approval trends, completion rates
   - Filter: By CSP, client, date range, status
   - Export: Comprehensive reports with charts

3. **Team Members** â†’ See individual employee history
   - Click any team member
   - View: All their leave requests (past and present)
   - See: PTO balance calculations with usage breakdown

#### **For Payroll Team:**
1. **Review Queue** â†’ Filter by `payroll-processing`
2. **Click any request** â†’ Download button appears
3. **Download Excel document** â†’ Perfectly formatted, ready to import

---

### **Method 2: Via API Endpoints (The Power Way)**

#### **GET All Leave Requests**
```
Endpoint: GET /api/leave-requests
Returns: Paginated list of all leave requests

Filters automatically by role:
- Directors â†’ See all 356 requests
- CSPs â†’ See only their team's requests
- Clients â†’ See only pending approvals for their employees
- Payroll â†’ See only approved requests ready for processing

Query Parameters:
?page=1&limit=10          â†’ Pagination
?status=client-approved   â†’ Filter by status
?teamMember=John Smith    â†’ Filter by employee
```

**Sample Response:**
```json
{
  "data": [
    {
      "id": "REQ-2025-356",
      "teamMember": "Sarah Johnson",
      "leaveType": "Annual Leave",
      "startDate": "2025-12-10",
      "endDate": "2025-12-15",
      "days": 5,
      "status": "client-approved",
      "submittedAt": "2025-12-01T09:00:00Z",
      "cspApprovedAt": "2025-12-01T10:15:00Z",
      "clientApprovedAt": "2025-12-02T14:30:00Z",
      "exportDocument": "/api/leave-requests/REQ-2025-356/download-export",
      "history": [
        {
          "action": "submitted",
          "actor": "Sarah Johnson",
          "timestamp": "2025-12-01T09:00:00Z"
        },
        {
          "action": "csp-approved",
          "actor": "Tsungi (CSP)",
          "timestamp": "2025-12-01T10:15:00Z"
        },
        {
          "action": "client-approved",
          "actor": "Client via Email",
          "timestamp": "2025-12-02T14:30:00Z",
          "method": "offline-email"
        },
        {
          "action": "sent-to-payroll",
          "actor": "Tsungi (CSP)",
          "timestamp": "2025-12-02T15:01:00Z",
          "documentGenerated": true
        }
      ]
    }
  ],
  "page": 1,
  "limit": 10,
  "total": 356
}
```

#### **GET Specific Leave Request**
```
Endpoint: GET /api/leave-requests/:id
Returns: Complete details of one request

Example: GET /api/leave-requests/REQ-2025-356
```

#### **Download Payroll Document**
```
Endpoint: GET /api/leave-requests/:id/download-export
Returns: Excel file ready for payroll processing

Auto-generated when request is client-approved
Stored in: server/exports/leave_{id}_{timestamp}.xlsx
Contains: All employee info, dates, approvals, audit trail
```

#### **Export Batch to Belina Payroll**
```
Endpoint: GET /api/export-belina-leave
Returns: Excel file with all approved requests in Belina format

Filters: Only client-approved or payroll-processing requests
Format: Belina Payroll System compatible
```

---

### **Method 3: Direct File Access (The Technical Way)**

#### **Read leaveRequests.json Directly**
```bash
# Location
server/leaveRequests.json

# Structure
[
  {
    "id": "REQ-2025-356",
    "teamMember": "Sarah Johnson",
    "status": "client-approved",
    "history": [...],
    "exportDocument": "exports/leave_356_1733162460.xlsx"
  },
  // ... 355 more requests
]
```

#### **Access Exported Documents**
```bash
# Location
server/exports/

# Files
leave_1_1733162460.xlsx      â†’ Request ID 1, generated Dec 2, 2025 3:01 PM
leave_2_1733163500.xlsx      â†’ Request ID 2, generated Dec 2, 2025 3:18 PM
leave_356_1733164800.xlsx    â†’ Request ID 356, generated Dec 2, 2025 3:40 PM

# Each file contains:
- Employee name, ID, department, CSP
- Leave type, dates, days
- All approval timestamps
- Full audit trail
- Ready for payroll import
```

---

## ğŸ“Š What Gets Stored (Complete Data Inventory)

### **For Every Approved Request:**

1. **Core Data** (Stored in leaveRequests.json)
   - âœ… Request ID (unique identifier)
   - âœ… Employee information (name, ID, department, CSP)
   - âœ… Leave details (type, dates, days, reason)
   - âœ… Current status (submitted â†’ csp-approved â†’ client-approved â†’ payroll-processing â†’ completed)
   - âœ… PTO balance impact (remaining days before/after)

2. **Approval Chain** (Complete audit trail)
   - âœ… Submitted by: Employee name + timestamp
   - âœ… CSP approved by: CSP name + timestamp + decision
   - âœ… Client approved by: Method (online/offline/phone/meeting) + timestamp + approver
   - âœ… Sent to payroll by: CSP name + timestamp + notes

3. **History Array** (Every action tracked)
   ```json
   "history": [
     { "action": "submitted", "actor": "Sarah", "timestamp": "..." },
     { "action": "csp-approved", "actor": "Tsungi", "timestamp": "..." },
     { "action": "client-approved", "actor": "Client Email", "timestamp": "...", "method": "offline" },
     { "action": "sent-to-payroll", "actor": "Tsungi", "timestamp": "...", "documentGenerated": true }
   ]
   ```

4. **Generated Document** (Physical Excel file)
   - âœ… Stored in: `server/exports/leave_{id}_{timestamp}.xlsx`
   - âœ… Link saved in: `request.exportDocument` field
   - âœ… Contains: Formatted payroll-ready data
   - âœ… Downloadable via: API endpoint

5. **Notification Records** (Communication log)
   - âœ… Who was notified (CSP, client, payroll)
   - âœ… When they were notified
   - âœ… Whether they read the notification
   - âœ… Any responses or actions taken

---

## ğŸ” Data Security & Compliance

### **Who Can Access What:**

```
Role-Based Access Control:

ğŸ‘¤ Team Member
   â””â”€ Can see: Their own requests only
   â””â”€ Can access: Their PTO balance, submission history

ğŸ‘” CSP
   â””â”€ Can see: All requests from their assigned teams only
   â””â”€ Can access: Approval queue, team member data, analytics for their CSP
   â””â”€ Can export: Documents for their approved requests

ğŸ‘‘ Director/Admin
   â””â”€ Can see: Everything (all 356 requests, all 87 team members)
   â””â”€ Can access: Full analytics, all exports, complete audit trail
   â””â”€ Can export: Any document, comprehensive reports

ğŸ¢ Client
   â””â”€ Can see: Only requests for their contracted employees
   â””â”€ Can access: Pending approvals only (not historical)
   â””â”€ Can export: None (view-only access)

ğŸ’° Payroll
   â””â”€ Can see: Only approved requests (client-approved or payroll-processing)
   â””â”€ Can access: Generated documents, export links
   â””â”€ Can export: Belina format batch files
```

---

## ğŸ”„ Data Sync & Backup

### **Google Sheets Integration:**
```
CorePTO â†â†’ Google Sheets (Bi-directional sync)

When you click "Sync All Sheets":
1. CorePTO reads from your 4 Google Sheets tabs
2. Enriches data with relationships and calculations
3. Updates leaveRequests.json with new/changed records
4. Existing approvals and history are preserved
5. No data lossâ€”only additions and updates

Your Google Sheet remains your backup
Your JSON files remain your source of truth
Both stay in perfect sync
```

### **Export & Backup Options:**

1. **Manual Export** (Any time)
   - Download all leave requests as Excel
   - Export team roster with PTO balances
   - Generate comprehensive reports with filters

2. **Automatic Document Generation** (Every approval)
   - When client approves â†’ Excel doc auto-created
   - Stored permanently in `exports/` folder
   - Downloadable link saved in request record
   - Never lost, always accessible

3. **Google Sheets Backup** (Live sync)
   - Historical requests synced back to "Leave Tracker" tab
   - PTO balances updated in "PTO Update" tab
   - Absenteeism logged in "Absenteeism tracker" tab

---

## ğŸ¯ Quick Retrieval Scenarios

### **Scenario 1**: *"Payroll needs Sarah's approved leave doc"*
**Solution**:
1. Go to Review Queue â†’ Filter status: "client-approved"
2. Find: Sarah Johnson, Dec 10-15, 5 days
3. Click: Download button
4. Get: `leave_356_1733162460.xlsx` (instant download)

**Alternative**:
- API: `GET /api/leave-requests/REQ-2025-356/download-export`
- Direct: Open `server/exports/leave_356_1733162460.xlsx`

---

### **Scenario 2**: *"Director needs Q4 approval analytics"*
**Solution**:
1. Go to Analytics & Reports
2. Filter: Oct 1 - Dec 31, 2025
3. See: 
   - 87 requests submitted
   - 82 approved (94% approval rate)
   - Average approval time: 28 hours
   - Top leave type: Annual Leave (65%)
4. Export: Comprehensive Q4 report with charts

**Alternative**:
- API: `GET /api/leave-requests?startDate=2025-10-01&endDate=2025-12-31`
- Direct: Parse `leaveRequests.json` with date filters

---

### **Scenario 3**: *"Client asks: 'Did I approve John's request?'"*
**Solution**:
1. Search: "John Smith" in Review Queue
2. Find: Request REQ-2025-340, Dec 20-24
3. Check History array:
   ```json
   {
     "action": "client-approved",
     "actor": "Client via Phone",
     "timestamp": "2025-12-03T10:45:00Z",
     "method": "phone",
     "approvedBy": "CSP marked after phone call"
   }
   ```
4. Answer: "Yes, approved via phone on Dec 3 at 10:45 AM"

---

## ğŸ’¡ The Storage Philosophy

### **We don't just store dataâ€”we make it retrievable, searchable, and useful.**

- âœ… **Stored once** â†’ Accessible everywhere (UI, API, files)
- âœ… **Complete history** â†’ Never lose context or decisions
- âœ… **Multi-format exports** â†’ Excel, JSON, Google Sheets
- âœ… **Role-based access** â†’ Security + compliance built-in
- âœ… **Permanent documents** â†’ 356 requests = 356 perfect Excel files
- âœ… **Audit-ready** â†’ Every action tracked, timestamped, attributed

---

**Data Storage Summary:**
- **Primary**: JSON files (lightweight, fast, human-readable)
- **Documents**: Auto-generated Excel files (1 per approval)
- **Backup**: Google Sheets (live bi-directional sync)
- **Access**: UI, API endpoints, direct file access
- **Security**: Role-based filtering automatically applied
- **Retrieval**: Search, filter, exportâ€”any way you need

*We didn't just build storageâ€”we built a retrieval system. We don't just save recordsâ€”we preserve decisions. We don't just track historyâ€”we create legal-grade proof.*

---

## ğŸ—„ï¸ Neon Database: The Absenteeism Engine

### **The Question**: *"What is Neon DB for?"*

### *Neon is CorePTO's **PostgreSQL database in the cloud**â€”specifically for managing **absenteeism reports**. It's our structured data warehouse for absence tracking and compliance.



## ğŸ¯ Why Neon? The Architecture Decision

### **The Problem We Solved:**
Absenteeism data is **complex and relational**:
- Multiple date ranges (start date, end date, week start)
- Boolean flags (authorized vs. unauthorized, form sent vs. pending)
- CSP-specific filtering (each CSP sees only their team's absences)
- Historical queries (weekly reports, monthly trends, yearly analytics)
- CRUD operations (Create, Read, Update, Delete records)

**JSON files** work great for:
- âœ… Simple key-value storage (leave requests, team members)
- âœ… Append-only logs (notifications, history)
- âœ… Google Sheets sync (flat data structures)

**But absenteeism needs**:
- âŒ Complex queries (filter by date range + CSP + authorization status)
- âŒ Concurrent writes (multiple CSPs updating reports simultaneously)
- âŒ Data integrity (foreign key relationships, data types)
- âŒ Performance at scale (indexed searches, aggregations)

**Solution**: Use **Neon PostgreSQL** for structured, queryable, relational data.

---

## ğŸ“Š What Neon Stores

### **Single Table: `absenteeism_reports`**

```sql
CREATE TABLE absenteeism_reports (
  id TEXT PRIMARY KEY,              -- Unique report ID
  week_start DATE,                  -- Start of absence week
  start_date DATE,                  -- First day of absence
  end_date DATE,                    -- Last day of absence
  no_of_days INTEGER,               -- Total days absent (including weekends)
  no_of_days_no_wknd INTEGER,       -- Business days absent (excluding weekends)
  name_of_absentee TEXT,            -- Employee name
  reason_for_absence TEXT,          -- Sick, PTO, Holiday, Funeral, Emergency
  absenteeism_authorised BOOLEAN,   -- Authorized (approved) or unauthorized
  leave_form_sent BOOLEAN,          -- Official form submitted to payroll?
  comment TEXT,                     -- Additional notes/context
  client TEXT,                      -- Client company name
  csp TEXT,                         -- CSP responsible (Tsungi, etc.)
  country TEXT,                     -- Employee country/location
  week_no INTEGER,                  -- Week number of year (1-52)
  month TEXT,                       -- Month name (JANUARY, FEBRUARY, etc.)
  year INTEGER,                     -- Year (2025, etc.)
  time_stamp TIMESTAMPTZ,           -- When absence was logged
  created_by TEXT,                  -- Who created the report (CSP name)
  created_at TIMESTAMPTZ,           -- Record creation timestamp
  updated_at TIMESTAMPTZ            -- Last update timestamp
);
```

**Example Record:**
```json
{
  "id": "ABS-2025-087",
  "week_start": "2025-12-01",
  "start_date": "2025-12-03",
  "end_date": "2025-12-05",
  "no_of_days": 3,
  "no_of_days_no_wknd": 3,
  "name_of_absentee": "John Smith",
  "reason_for_absence": "Sick",
  "absenteeism_authorised": true,
  "leave_form_sent": true,
  "comment": "Medical certificate provided",
  "client": "Tech Corp",
  "csp": "Tsungi",
  "country": "Zimbabwe",
  "week_no": 49,
  "month": "DECEMBER",
  "year": 2025,
  "time_stamp": "2025-12-03T08:30:00Z",
  "created_by": "Tsungi",
  "created_at": "2025-12-03T08:30:00Z",
  "updated_at": "2025-12-03T08:30:00Z"
}
```

---

## ğŸ”„ How Neon Integrates with CorePTO

### **The Data Flow:**

```
Google Sheets "Absenteeism tracker" tab
             â†“
    (Read-only sync)
             â†“
    CorePTO processes grid format
             â†“
    Validates & enriches data
             â†“
    Writes to Neon PostgreSQL
             â†“
    âœ… Stored permanently
    âœ… Queryable instantly
    âœ… CSP-filtered automatically
```

**Key Point**: 
- **Google Sheets** = Source of truth (where CSPs manually log absences)
- **Neon DB** = Structured warehouse (where CorePTO queries and analyzes)
- **One-way sync**: Sheets â†’ Neon (never write back to sheets)

---

## ğŸ› ï¸ What You Can Do with Neon Data

### **1. CSP-Specific Queries**
```javascript
// Get all absences for Tsungi's team
GET /api/absenteeism-reports?csp=Tsungi

// Returns only records where csp = "Tsungi"
// Automatically filtered by role-based access control
```

### **2. Date Range Analytics**
```sql
-- Find all absences in December 2025
SELECT * FROM absenteeism_reports
WHERE month = 'DECEMBER' AND year = 2025;

-- Calculate total days absent by reason
SELECT reason_for_absence, SUM(no_of_days_no_wknd) as total_days
FROM absenteeism_reports
WHERE year = 2025
GROUP BY reason_for_absence;
```

### **3. Compliance Tracking**
```sql
-- Find unauthorized absences without leave forms
SELECT * FROM absenteeism_reports
WHERE absenteeism_authorised = false
   OR leave_form_sent = false;

-- Flag for HR follow-up
```

### **4. Weekly Reports**
```sql
-- Get this week's absences
SELECT * FROM absenteeism_reports
WHERE week_no = 49 AND year = 2025
ORDER BY start_date DESC;
```

---

## ğŸ” Security & Access Control

### **Role-Based Filtering (Automatic)**

When a CSP queries absenteeism reports:
```javascript
// CSP Tsungi logs in
const csp = req.user.cspName; // "Tsungi"

// Query automatically filtered
const reports = await getAbsenteeismReports(csp);

// Returns: Only records where csp = "Tsungi"
// Hides: All other CSPs' team absences
```

When a Director queries:
```javascript
// Director role has full access
const reports = await getAbsenteeismReports(); // No filter

// Returns: All 87 absence records across all CSPs
```

---

## ğŸ“ˆ Why This Matters: Real-World Scenarios

### **Scenario 1**: *"Weekly Compliance Report"*
**Before Neon**:
- Open Google Sheets absenteeism tab
- Manually filter by week 49
- Copy 15 rows to Excel
- Calculate total days absent
- Write summary in email
- **Time**: 25 minutes

**With Neon**:
```sql
SELECT 
  csp, 
  COUNT(*) as absence_count,
  SUM(no_of_days_no_wknd) as total_days,
  SUM(CASE WHEN absenteeism_authorised = false THEN 1 ELSE 0 END) as unauthorized_count
FROM absenteeism_reports
WHERE week_no = 49 AND year = 2025
GROUP BY csp;
```
**Result**: Instant summary for all CSPs
**Time**: 10 seconds

---

### **Scenario 2**: *"Client Asks: 'How many sick days did my team take in Q4?'"*
**Before Neon**:
- Open sheets, scroll through 87 records
- Manually count "Sick" entries for that client
- Calculate totals by hand
- Hope you didn't miss any
- **Time**: 15 minutes, **Accuracy**: 85%

**With Neon**:
```sql
SELECT 
  name_of_absentee,
  COUNT(*) as sick_days_count,
  SUM(no_of_days_no_wknd) as total_sick_days
FROM absenteeism_reports
WHERE client = 'Tech Corp'
  AND reason_for_absence = 'Sick'
  AND month IN ('OCTOBER', 'NOVEMBER', 'DECEMBER')
  AND year = 2025
GROUP BY name_of_absentee;
```
**Result**: Exact breakdown per employee
**Time**: Instant, **Accuracy**: 100%

---

### **Scenario 3**: *"Flag Unauthorized Absences for HR"*
**Before Neon**:
- Manually scan 87 records
- Check if "Authorized" column = "No"
- Copy to separate list
- Email HR with names
- **Time**: 30 minutes

**With Neon**:
```sql
SELECT 
  name_of_absentee,
  start_date,
  end_date,
  no_of_days_no_wknd,
  reason_for_absence,
  comment
FROM absenteeism_reports
WHERE absenteeism_authorised = false
  AND year = 2025
ORDER BY start_date DESC;
```
**Result**: Auto-generated flagged list
**Time**: 2 seconds
**Action**: Export to Excel, email HR, done.

---

## ğŸš€ Neon Features We Use

### **1. Serverless PostgreSQL**
- âœ… No server to manage (cloud-hosted)
- âœ… Auto-scaling (handles 10 or 10,000 records)
- âœ… Always available (99.9% uptime SLA)

### **2. Connection Pooling**
```javascript
const pool = new Pool({ 
  connectionString: process.env.DATABASE_URL,
  ssl: { rejectUnauthorized: false }
});
```
- Multiple CSPs can query simultaneously
- No connection limit issues
- Efficient resource usage

### **3. ACID Compliance**
- **Atomicity**: All or nothing writes
- **Consistency**: Data integrity enforced
- **Isolation**: Concurrent updates don't conflict
- **Durability**: Once written, never lost

### **4. SQL Power**
```sql
-- Complex analytics in one query
WITH monthly_stats AS (
  SELECT 
    month,
    COUNT(*) as total_absences,
    AVG(no_of_days_no_wknd) as avg_days,
    SUM(CASE WHEN absenteeism_authorised = false THEN 1 ELSE 0 END) as unauthorized
  FROM absenteeism_reports
  WHERE year = 2025
  GROUP BY month
)
SELECT * FROM monthly_stats
ORDER BY total_absences DESC;
```
**Result**: Month-by-month absence trends with averages and flags

---

## ğŸ”„ The Sync Process

### **Google Sheets â†’ Neon (One-Way)**

When you click **"Sync All Sheets"** in CorePTO:

1. **Read** from Google Sheets "Absenteeism tracker" tab
   - 87 rows with complex monthly grid format
   - Columns: Employee name, days 1-31, status codes

2. **Parse** complex grid structure
   - Detect month sections (JANUARY 1-31, FEBRUARY 1-28, etc.)
   - Identify absence dates (marked with "Sick", "PTO", "Holiday")
   - Calculate consecutive date ranges
   - Count business days (exclude weekends)

3. **Enrich** with metadata
   - Look up CSP from teamMemberMeta.json
   - Add client information
   - Calculate week number
   - Generate unique report ID

4. **Validate** data integrity
   - Check required fields (name, dates, reason)
   - Ensure date ranges are valid
   - Verify CSP assignments exist

5. **Write** to Neon PostgreSQL
   ```javascript
   await createAbsenteeismReport({
     id: "ABS-2025-087",
     name: "John Smith",
     startDate: "2025-12-03",
     endDate: "2025-12-05",
     reason: "Sick",
     authorized: true,
     csp: "Tsungi",
     // ... 15 more fields
   });
   ```

6. **Deduplicate** (avoid duplicates)
   - Check if report ID already exists
   - Update instead of insert if found
   - Preserve original created_at timestamp

**Result**: 87 absence records synced, queryable instantly

---

## ğŸ’¡ The Neon Philosophy

### **We don't just log absencesâ€”we enable insights.**

**Without Neon:**
- âŒ Manual spreadsheet searches
- âŒ Copy-paste to Excel for reports
- âŒ Error-prone calculations
- âŒ No role-based filtering
- âŒ Single-user access (one person in sheet at a time)

**With Neon:**
- âœ… Instant SQL queries
- âœ… Auto-generated reports
- âœ… 100% accurate calculations
- âœ… Automatic CSP filtering
- âœ… Concurrent access (all CSPs can query simultaneously)

---

## ğŸ¯ Quick Reference

### **Setup Neon (One-Time)**
```powershell
# 1. Get connection string from console.neon.tech
# 2. Set environment variable
$env:DATABASE_URL = "postgresql://user@host.neon.tech/db?password=xxx"

# 3. Start server (auto-creates table)
node index.js
# Output: Database initialized (absenteeism_reports)
```

### **Query via API**
```javascript
// Get all absences for your CSP
GET /api/absenteeism-reports

// Get specific report
GET /api/absenteeism-reports/:id

// Create new report
POST /api/absenteeism-reports
Body: { name, startDate, endDate, reason, ... }

// Update report
PUT /api/absenteeism-reports/:id
Body: { authorized: true, leaveFormSent: true }

// Delete report
DELETE /api/absenteeism-reports/:id
```

### **Direct SQL Access**
```javascript
import { pool } from './db.js';

// Custom query
const result = await pool.query(`
  SELECT * FROM absenteeism_reports 
  WHERE csp = $1 AND year = $2
`, ['Tsungi', 2025]);

console.log(result.rows); // Array of records
```

---

## ğŸ† The Impact

### **Before Neon:**
- ğŸ“Š Absence data trapped in spreadsheets
- ğŸ” Manual searches taking 15-30 minutes
- ğŸ“ˆ No real-time analytics
- ğŸš« No CSP-specific filtering
- âŒ Error-prone manual calculations

### **After Neon:**
- ğŸ“Š Absence data queryable via SQL
- ğŸ” Instant searches (< 1 second)
- ğŸ“ˆ Real-time analytics and trends
- âœ… Automatic role-based access
- âœ… 100% accurate, database-driven calculations

### **ROI:**
- **Time saved**: 15-30 min/query â†’ 10 seconds (99% faster)
- **Accuracy**: 85% â†’ 100% (no manual errors)
- **Concurrent users**: 1 â†’ Unlimited
- **Report generation**: Manual â†’ Automated
- **Compliance**: Manual audits â†’ Instant SQL queries

---

**Neon Database Summary:**
- **Purpose**: Structured storage for absenteeism reports
- **Why PostgreSQL**: Complex queries, relational data, ACID compliance
- **Why Neon**: Serverless, auto-scaling, zero maintenance
- **Data flow**: Google Sheets â†’ CorePTO â†’ Neon (one-way sync)
- **Access**: Role-based (CSPs see only their team's data)
- **Benefits**: Instant queries, automated reports, 100% accuracy

*We didn't just log absencesâ€”we built an analytics engine. We don't just track time offâ€”we reveal patterns. We don't just store recordsâ€”we enable compliance.*

---

**CorePTO: At the Core of Your Workforce**

*Stop managing requests. Start managing your business.* ğŸš€
